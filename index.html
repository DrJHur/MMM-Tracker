<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Mind Mirror (MMM)</title>
    
    <!-- 1. Vintage Font: Gowun Batang Import & Pretendard -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard-dynamic-subset.css" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    
    <style>
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #333; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: #eee; }

        /* 1. 몽환적인 그라데이션 배경 (핑크, 노랑, 블루) */
        body {
            background: linear-gradient(120deg, #EFABB4, #FFD16D, #51A0AF);
            background-attachment: fixed;
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite; 
            color: #1a1a1a; 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            font-weight: 700; 
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        canvas { width: 100% !important; height: 100% !important; }

        /* 3. 비비드 & 고대비 컬러 클래스 */
        
        /* PHQ-9: Vivid Cyan/Teal */
        .bg-vivid-teal { background-color: #00B4D8; }
        .text-vivid-teal { color: #0077B6; }
        .btn-teal { background-color: #0096C7; color: #FFFFFF; border: 2px solid #0077B6; }
        .btn-teal:hover { background-color: #023E8A; color: #FFF; }

        /* GAD-7: Vivid Yellow/Amber */
        .bg-vivid-yellow { background-color: #FFD60A; }
        .text-vivid-yellow { color: #B45309; }
        .btn-yellow { background-color: #FFC300; color: #000000; border: 2px solid #B45309; }
        .btn-yellow:hover { background-color: #FFD60A; }

        /* PSS: Vivid Pink/Red */
        .bg-vivid-pink { background-color: #FF006E; }
        .text-vivid-pink { color: #C9184A; }
        .btn-pink { background-color: #FF006E; color: #FFFFFF; border: 2px solid #800F2F; }
        .btn-pink:hover { background-color: #C9184A; }

        /* 카드 스타일 */
        .card-style {
            background-color: #FFFFFF;
            border: 2px solid #333;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.8); 
            border-radius: 1rem;
        }
        
        /* 입력폼 스타일 */
        .input-vivid {
            border: 2px solid #333;
            font-weight: 700;
            color: #000;
        }
        .input-vivid:focus {
            border-color: #FF006E;
            outline: none;
            box-shadow: 2px 2px 0px #FF006E;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 relative overflow-y-auto">

    <!-- 메인 컨테이너 -->
    <div id="app" class="w-full max-w-4xl bg-white shadow-2xl rounded-3xl p-6 md:p-10 border-4 border-black relative z-10 my-8">

        <!-- 제목 -->
        <div class="relative mb-10 pt-2 text-center"> 
            <h1 class="text-4xl md:text-5xl font-extrabold text-black mb-3 tracking-tight">My Mind Mirror, MMM (음-)</h1>
            <p class="text-lg md:text-xl text-gray-700 font-bold">1주일에 한 번은 검사를 진행하고,<br class="md:hidden"> 음- 그렇구나,하고 자기 마음을 알아주세요.</p>
        </div>

        <!-- 사용자 정보 -->
        <div class="mb-8 flex flex-col md:flex-row justify-between items-center text-sm border-b-4 border-black pb-6 gap-4">
            <div id="user-info" class="text-black flex items-center gap-3 font-extrabold text-lg">
                <p>ID: <span id="display-user-id" class="font-mono text-sm bg-yellow-200 px-3 py-1 rounded border-2 border-black">인증 필요</span></p>
                <p>상태: <span id="auth-status" class="text-red-600">로드 중...</span></p>
                <button id="signout-button" class="hidden text-sm px-4 py-1 bg-black text-white rounded hover:bg-gray-800 transition border-2 border-transparent">로그아웃</button>
            </div>
            <div id="loading-indicator" class="hidden flex items-center gap-2 text-blue-600 font-extrabold">
                <svg class="animate-spin h-6 w-6" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                <span>처리 중...</span>
            </div>
        </div>

        <!-- 로그인 폼 -->
        <div id="auth-blocker" class="mb-12 p-8 bg-yellow-50 border-4 border-black rounded-2xl shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] text-center">
            <h3 class="font-extrabold text-2xl text-black mb-3">회원가입/로그인 필요</h3>
            <p class="text-black/80 mb-6 text-lg font-bold">개인 정보의 안전한 저장을 위해<br>이메일과 비밀번호로 회원가입, 로그인 해주세요.</p>
            
            <form id="auth-form" class="max-w-md mx-auto space-y-4">
                <input type="email" id="auth-email" placeholder="이메일 주소" required class="w-full p-4 input-vivid rounded-xl bg-white placeholder-gray-500">
                <input type="password" id="auth-password" placeholder="비밀번호 (6자 이상)" required class="w-full p-4 input-vivid rounded-xl bg-white placeholder-gray-500">
                <div class="flex gap-4 justify-center pt-2">
                    <button type="submit" id="auth-submit-button" data-mode="signin" class="flex-1 px-6 py-4 bg-black text-white font-extrabold text-lg rounded-xl hover:bg-gray-800 transition shadow-lg">로그인</button>
                    <a href="#" id="auth-mode-toggle" class="flex-1 px-6 py-4 border-4 border-black text-black font-extrabold text-lg rounded-xl hover:bg-gray-100 transition text-center flex items-center justify-center">회원가입 하기</a>
                </div>
            </form>
        </div>

        <!-- 측정 버튼들 -->
        <div id="assessment-buttons" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <button data-scale="PHQ9" class="p-5 rounded-2xl font-extrabold shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-transform transform hover:-translate-y-1 btn-teal disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <span class="block text-2xl mb-1">PHQ-9</span>
                <span class="text-base opacity-90 font-bold">(우울) 측정</span>
            </button>
            <button data-scale="GAD7" class="p-5 rounded-2xl font-extrabold shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-transform transform hover:-translate-y-1 btn-yellow disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <span class="block text-2xl mb-1">GAD-7</span>
                <span class="text-base opacity-90 font-bold">(불안) 측정</span>
            </button>
            <button data-scale="PSS" class="p-5 rounded-2xl font-extrabold shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-transform transform hover:-translate-y-1 btn-pink disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <span class="block text-2xl mb-1">PSS</span>
                <span class="text-base opacity-90 font-bold">(스트레스) 측정</span>
            </button>
        </div>

        <!-- 메시지 박스 -->
        <div id="message-box" class="hidden px-6 py-4 rounded-xl mb-8 border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] text-center" role="alert">
            <strong id="message-title" class="font-extrabold block mb-1 text-xl"></strong> 
            <span id="message-text" class="block font-bold text-lg"></span>
        </div>

        <!-- 차트 섹션 -->
        <div class="bg-white p-8 rounded-3xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,0.2)]">
            <h2 class="text-3xl font-extrabold text-black mb-8 text-center">나의 MMM (음-) 프로파일</h2>
            <div id="chart-caption" class="text-center text-sm text-gray-500 mb-10 font-bold">데이터가 없습니다. 측정을 시작해 주세요!</div>

            <div class="space-y-12">
                <!-- PHQ-9 Chart -->
                <div class="p-6 rounded-2xl bg-white border-4 border-[#0096C7] shadow-lg">
                    <h3 class="font-extrabold text-2xl text-[#0077B6] mb-4 flex items-center gap-3">
                        <span class="w-4 h-4 rounded-full bg-[#0096C7] border-2 border-black"></span> 우울의 움직임 (PHQ-9)
                    </h3>
                    <div class="relative h-64 md:h-80"><canvas id="phqChart"></canvas></div>
                </div>
                <!-- GAD-7 Chart -->
                <div class="p-6 rounded-2xl bg-white border-4 border-[#FFC300] shadow-lg">
                    <h3 class="font-extrabold text-2xl text-[#B45309] mb-4 flex items-center gap-3">
                        <span class="w-4 h-4 rounded-full bg-[#FFC300] border-2 border-black"></span> 불안의 움직임 (GAD-7)
                    </h3>
                    <div class="relative h-64 md:h-80"><canvas id="gadChart"></canvas></div>
                </div>
                <!-- PSS Chart -->
                <div class="p-6 rounded-2xl bg-white border-4 border-[#FF006E] shadow-lg">
                    <h3 class="font-extrabold text-2xl text-[#C9184A] mb-4 flex items-center gap-3">
                        <span class="w-4 h-4 rounded-full bg-[#FF006E] border-2 border-black"></span> 내가 느끼는 스트레스 (PSS)
                    </h3>
                    <div class="relative h-64 md:h-80"><canvas id="pssChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- 요약 섹션 -->
        <div class="mt-12">
            <h2 class="text-3xl font-extrabold text-black mb-6 text-center">최근 측정 요약</h2>
            <div id="latest-summary" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-6 card-style border-[#0096C7]">
                    <p class="font-extrabold text-xl text-[#0077B6] mb-2">PHQ-9</p>
                    <div class="flex items-end gap-2">
                        <p class="text-5xl font-black text-black" id="latest-phq">--</p>
                        <p class="text-sm text-gray-600 mb-2 font-bold">/ 27점</p>
                    </div>
                </div>
                <div class="p-6 card-style border-[#FFC300]">
                    <p class="font-extrabold text-xl text-[#B45309] mb-2">GAD-7</p>
                    <div class="flex items-end gap-2">
                        <p class="text-5xl font-black text-black" id="latest-gad">--</p>
                        <p class="text-sm text-gray-600 mb-2 font-bold">/ 21점</p>
                    </div>
                </div>
                <div class="p-6 card-style border-[#FF006E]">
                    <p class="font-extrabold text-xl text-[#C9184A] mb-2">PSS</p>
                    <div class="flex items-end gap-2">
                        <p class="text-5xl font-black text-black" id="latest-pss">--</p>
                        <p class="text-sm text-gray-600 mb-2 font-bold">/ 40점</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="assessment-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl shadow-[10px_10px_0px_0px_rgba(255,255,255,0.2)] w-full max-w-lg overflow-hidden transform transition-all duration-300 border-4 border-black">
            <div id="modal-header" class="p-6 text-white text-2xl font-black border-b-4 border-black"><span id="scale-title"></span> 측정</div>
            <div class="p-6 custom-scrollbar max-h-[70vh] overflow-y-auto"><form id="assessment-form"></form></div>
            <div class="p-6 border-t-4 border-black flex justify-end space-x-3 bg-gray-50">
                <button id="cancel-assessment" type="button" class="px-6 py-3 bg-white border-2 border-black text-black rounded-xl hover:bg-gray-100 font-extrabold shadow-md">취소</button>
                <button id="submit-assessment" type="submit" form="assessment-form" class="px-6 py-3 text-white rounded-xl font-extrabold shadow-md border-2 border-black">결과 저장</button>
            </div>
        </div>
    </div>
